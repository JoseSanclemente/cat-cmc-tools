<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Streamlined Banner Generator</title>

    <!-- Global font & styles -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Host+Grotesk:ital,wght@0,300..800;1,300..800&display=swap");
      @import url("../styles/global.css");
      @import url("../styles/pages/streamlined_banners_generator.css");
    </style>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
    <!-- End Bootstrap -->

    <!-- Components -->
    <script src="../components/Header.js"></script>
    <!-- End Components -->
  </head>
  <body>
    <header-component
      back-button
      title="Streamlined Banner Generator"
    ></header-component>
    <div class="form-container mt-5">
      <div class="form-group">
        <label for="language">Select Language:</label>
        <select id="language"></select>
      </div>

      <div class="form-group">
        <label for="promoType">Promotion Type:</label>
        <select id="promoType" onchange="toggleFields()">
          <option value="category">Category Promotion</option>
          <option value="sitewide">Site Wide Promotion</option>
        </select>
      </div>

      <div class="form-group" id="categoryGroup">
        <label>Category Name:</label>
        <input type="text" id="category" placeholder="Ex: Batteries" />
      </div>

      <div class="form-group">
        <label>Promo Code (Optional):</label>
        <input type="text" id="code" placeholder="Ex: BAT20" />
      </div>

      <div class="form-group">
        <label>Discount Percentage:</label>
        <input type="text" id="percentage" placeholder="Ex: 20" />
      </div>

      <div class="form-group">
        <label id="ctaUrlLabel">CTA URL:</label>
        <input
          type="text"
          id="ctaUrl"
          placeholder="Ex: ground-engaging-tools"
        />
      </div>

      <div class="form-group">
        <label>Terms & Conditions URL:</label>
        <input
          type="text"
          id="externalUrl"
          placeholder="Ex: https://parts.cat.com/es/toromont/promo-yellow-thursday"
        />
      </div>

      <div class="form-group">
        <label>Start Date & Time:</label>
        <div style="display: flex; gap: 10px">
          <input
            type="date"
            id="startDate"
            style="flex: 1"
            onchange="setInitialStartTime()"
          />
          <input type="time" id="startTime" style="flex: 1" />
        </div>
      </div>

      <div class="form-group">
        <label>End Date & Time:</label>
        <div style="display: flex; gap: 10px">
          <input
            type="date"
            id="endDate"
            style="flex: 1"
            onchange="setInitialEndTime()"
          />
          <input type="time" id="endTime" style="flex: 1" />
        </div>
      </div>

      <div class="form-group">
        <label>Dealer Name:</label>
        <input type="text" id="dealerName" placeholder="Ex: DealerName" />
      </div>

      <div class="form-group">
        <label>Ticket Number:</label>
        <input type="text" id="ticketNumber" placeholder="Ex: 12345" />
      </div>

      <div class="form-group">
        <label>Target:</label>
        <select id="target">
          <option value="All Customers">All Customers</option>
          <option value="Only Specified DCN's can see this promotion">
            Only Specified DCN's can see this promotion
          </option>
          <option value="Only guests can see this promotion">
            Only guests can see this promotion
          </option>
          <option value="Only registered users can see this promotion">
            Only registered users can see this promotion
          </option>
        </select>
      </div>

      <button onclick="generateCode()">Generate HTML</button>

      <div class="output-section" id="results" style="display: none">
        <label for="finalHtml">Final HTML Code:</label>
        <textarea id="finalHtml" readonly></textarea>

        <label for="contentFile" style="margin-top: 10px; display: block"
          >Content File:</label
        >
        <textarea id="contentFile" readonly style="height: 50px"></textarea>

        <label for="webActivity" style="margin-top: 10px; display: block"
          >Web Activity:</label
        >
        <textarea id="webActivity" readonly style="height: 50px"></textarea>

        <label for="contentFolder" style="margin-top: 10px; display: block"
          >Content Folder:</label
        >
        <textarea id="contentFolder" readonly style="height: 50px"></textarea>

        <label for="activityFolder" style="margin-top: 10px; display: block"
          >Activity Folder:</label
        >
        <textarea id="activityFolder" readonly style="height: 50px"></textarea>

        <label for="description" style="margin-top: 10px; display: block"
          >Description:</label
        >
        <textarea id="description" readonly style="height: 120px"></textarea>

        <button class="secondary" onclick="copyToClipboard()">
          ðŸ“‹ Copy Code
        </button>
        <div id="visualPreview" class="preview-box"></div>
      </div>
    </div>

    <script>
      // Banner template
      const masterHTML = `
<section>
  <style>
    .CMC__Espot__Bg-Color--blue {
      background-color: var(
        --cat-theme-color-background-utility-information-strong
      );
    }
    .CMC__Espot__Ribbon_Height {
      height: 44px !important;
    }
    .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon-Mid--section {
      max-width: 968px;
    }
    .CMC__Espot__Ribbon_Container .cat-u-theme-typography-display-sm {
      line-height: calc(var(--cat-line-height-20) * 16 / 20) !important;
    }

    .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon_CTA-link {
      color: var(--cat-color-neutral-white) !important;
      line-height: calc(var(--cat-line-height-20) * 17 / 20) !important;
    }
    .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon_CTA-link:hover,
    .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon_CTA-link:active,
    .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon_CTA-link:focus {
      color: var(--cat-color-brand-blue-20) !important;
    }

    .CMC__Espot__Ribbon_CTA-Button {
      height: 32px;
      border-radius: var(--cat-border-radius-md);
      border: var(--cat-border-width-sm) solid
        var(--cat-theme-color-button-background);
      color: var(--cat-theme-color-content-knockout);
      max-width: 106px !important;
    }
    .CMC__Espot__Ribbon_CTA-Button:hover {
      background-color: var(--cat-color-brand-blue-60);
    }
    .CMC__Espot__Ribbon_CTA-Button:active {
      background-color: var(--cat-color-brand-blue-70);
    }

    @media only screen and (max-width: 1244.98px) {
      .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon-Mid--section {
        width: 73% !important;
      }
    }
    @media only screen and (max-width: 959.98px) {
      .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon-Mid--section {
        width: 90% !important;
      }
    }
    @media only screen and (max-width: 767.98px) {
      .CMC__Espot__Ribbon_Container .cat-u-theme-typography-display-sm,
      .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon_CTA-link {
        font-size: var(--cat-font-size-12) !important;
        line-height: var(--cat-line-height-16) !important;
      }
      .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon-Mid--section {
        width: 86% !important;
      }
    }
    @media only screen and (max-width: 575.98px) {
      .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon-Mid--section {
        width: 78% !important;
      }
      .CMC__Espot__Ribbon_Container .cat-u-theme-typography-display-sm,
      .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon_CTA-link,
      .CMC__Espot__Ribbon_CTA-Button {
        font-family: var(--cat-font-family-primary) !important;
        font-size: var(--cat-font-size-12) !important;
        line-height: var(--cat-line-height-16) !important;
        font-weight: var(--cat-font-weight-regular) !important;
      }
      .CMC__Espot__Ribbon_Container .CMC__Espot__Ribbon_CTA-Button {
        max-width: 80px !important;
      }
    }
  </style>

  <div
    class="CMC__Espot__Ribbon_Container CMC__Espot__Category_Promo_Percent_link_Btn w-100 CMC__Espot__Ribbon_Height CMC__Espot__Bg-Color--blue d-flex justify-content-center align-items-center"
  >
    <div
      class="CMC__Espot__Ribbon-Mid--section d-flex justify-content-center align-items-center w-100"
    >
      <cat-icon-tag
        class="d-none d-sm-block cat-icon"
        color="knockout"
        size="lg"
      ></cat-icon-tag>
      <p
        class="cat-u-theme-typography-display-sm CMC__Espot__Text-Color--white text-center px-2 mb-0"
      >
        [T_OFFER][T_CODE_TEXT]
        <cat-text-link
          size="sm"
          target="_blank"
          inverted
          class="ms-1"
          href="[ENTER_EXTERNAL_URL]"
          ><span
            class="CMC__Espot__Ribbon_CTA-link d-flex justify-content-center align-items-center text-decoration-underline m-0"
            >[T_DETAILS]</span
          ></cat-text-link
        >
      </p>
      <a
        target="_blank"
        class="CMC__Espot__Ribbon_CTA-Button cat-u-theme-typography-body-sm d-flex justify-content-center align-items-center px-1 px-md-2 w-100 text-decoration-none"
        href="[fullPathHomeURL]/[ENTER_CATEGORY_URL]"
        aria-label="[T_CTA]"
        >[T_CTA]</a
      >
    </div>
  </div>
</section>`;

      const translations = {
        en: {
          name: "ðŸ‡ºðŸ‡¸ English",
          T_DETAILS: "Details",
          T_CTA: "Shop Now",
          T_OFFER_CATEGORY: "[ENTER_NUMBER]% Off Selected [ENTER_CATEGORY]",
          T_OFFER_SITEWIDE: "[ENTER_NUMBER]% Off Your Next Order",
          T_CODE_TEXT: " | Code: [PROMO_CODE].",
        },
        es: {
          name: "ðŸ‡ªðŸ‡¸ EspaÃ±ol",
          T_DETAILS: "Detalles",
          T_CTA: "Comprar ahora",
          T_OFFER_CATEGORY:
            "[ENTER_NUMBER]% de descuento en [ENTER_CATEGORY] seleccionados",
          T_OFFER_SITEWIDE: "[ENTER_NUMBER]% de descuento en tu prÃ³xima orden",
          T_CODE_TEXT: " | CÃ³digo: [PROMO_CODE].",
        },
        pt: {
          name: "ðŸ‡§ðŸ‡· PortuguÃªs",
          T_DETAILS: "Detalhes",
          T_CTA: "Comprar agora",
          T_OFFER_CATEGORY:
            "[ENTER_NUMBER]% de desconto em [ENTER_CATEGORY] selecionados",
          T_OFFER_SITEWIDE: "[ENTER_NUMBER]% de desconto no seu prÃ³ximo pedido",
          T_CODE_TEXT: " | Cupom: [PROMO_CODE].",
        },
        fr: {
          name: "ðŸ‡«ðŸ‡· FranÃ§ais",
          T_DETAILS: "Details",
          T_CTA: "Acheter maintenant",
          T_OFFER_CATEGORY:
            "[ENTER_NUMBER]% de rÃ©duction sur [ENTER_CATEGORY] sÃ©lectionnÃ©",
          T_OFFER_SITEWIDE:
            "[ENTER_NUMBER]% de rÃ©duction sur votre prochaine commande",
          T_CODE_TEXT: " | Code : [PROMO_CODE].",
        },
        de: {
          name: "ðŸ‡©ðŸ‡ª Deutsch",
          T_DETAILS: "Details",
          T_CTA: "Jetzt kaufen",
          T_OFFER_CATEGORY:
            "[ENTER_NUMBER]% Rabatt auf ausgewÃ¤hlte [ENTER_CATEGORY]",
          T_OFFER_SITEWIDE:
            "[ENTER_NUMBER]% Rabatt auf Ihre nÃ¤chste Bestellung",
          T_CODE_TEXT: " | Code: [PROMO_CODE].",
        },
        it: {
          name: "ðŸ‡®ðŸ‡¹ Italiano",
          T_DETAILS: "Dettagli",
          T_CTA: "Acquista ora",
          T_OFFER_CATEGORY:
            "[ENTER_NUMBER]% di sconto su [ENTER_CATEGORY] selezionati",
          T_OFFER_SITEWIDE: "[ENTER_NUMBER]% di sconto sul tuo prossimo ordine",
          T_CODE_TEXT: " | Codice: [PROMO_CODE].",
        },
        bn: {
          name: "ðŸ‡§ðŸ‡© Bengali",
          T_DETAILS: "à¦¬à¦¿à¦¸à§à¦¤à¦¾à¦°à¦¿à¦¤",
          T_CTA: "à¦à¦–à¦¨ à¦•à¦¿à¦¨à§à¦¨",
          T_OFFER_CATEGORY: "à¦¬à¦¾à¦›à¦¾à¦‡à¦•à§ƒà¦¤ [ENTER_CATEGORY]-à¦ [ENTER_NUMBER]% à¦›à¦¾à§œ",
          T_OFFER_SITEWIDE: "à¦†à¦ªà¦¨à¦¾à¦° à¦ªà¦°à¦¬à¦°à§à¦¤à§€ à¦…à¦°à§à¦¡à¦¾à¦°à§‡ [ENTER_NUMBER]% à¦›à¦¾à§œ",
          T_CODE_TEXT: " | à¦•à§‹à¦¡: [PROMO_CODE].",
        },
        ko: {
          name: "ðŸ‡°ðŸ‡· Korean",
          T_DETAILS: "ìžì„¸ížˆ ë³´ê¸°",
          T_CTA: "ì§€ê¸ˆ ì‡¼í•‘í•˜ê¸°",
          T_OFFER_CATEGORY: "ì¼ë¶€ [ENTER_CATEGORY] [ENTER_NUMBER]% í• ì¸",
          T_OFFER_SITEWIDE: "ë‹¤ìŒ ì£¼ë¬¸ ì‹œ [ENTER_NUMBER]% í• ì¸",
          T_CODE_TEXT: " | ì½”ë“œ: [PROMO_CODE].",
        },
        // ... Keep adding languages ...
      };

      // Automatically fill the selector when the page loads
      const langSelect = document.getElementById("language");
      for (let key in translations) {
        let option = document.createElement("option");
        option.value = key;
        option.textContent = translations[key].name;
        langSelect.appendChild(option);
      }

      function toggleFields() {
        const promoType = document.getElementById("promoType").value;
        const categoryGroup = document.getElementById("categoryGroup");
        const ctaUrlLabel = document.getElementById("ctaUrlLabel");

        if (promoType === "sitewide") {
          categoryGroup.style.display = "none";
          ctaUrlLabel.textContent = "CTA URL (Optional):";
        } else {
          categoryGroup.style.display = "block";
          ctaUrlLabel.textContent = "CTA URL:";
        }
      }

      function setInitialStartTime() {
        const startTimeEl = document.getElementById("startTime");
        startTimeEl.value = "00:00";
      }

      function setInitialEndTime() {
        const endTimeEl = document.getElementById("endTime");
        endTimeEl.value = "23:59";
      }

      function generateCode() {
        // Reset errors
        document
          .querySelectorAll(".input-error")
          .forEach((el) => el.classList.remove("input-error"));

        const langKey = document.getElementById("language").value;

        const categoryEl = document.getElementById("category");
        const codeEl = document.getElementById("code");
        const percentageEl = document.getElementById("percentage");
        const externalUrlEl = document.getElementById("externalUrl");
        const ctaUrlEl = document.getElementById("ctaUrl");
        const startDateEl = document.getElementById("startDate");
        const startTimeEl = document.getElementById("startTime");
        const endDateEl = document.getElementById("endDate");
        const endTimeEl = document.getElementById("endTime");
        const dealerNameEl = document.getElementById("dealerName");
        const promoTypeEl = document.getElementById("promoType");
        const ticketNumberEl = document.getElementById("ticketNumber");
        const targetEl = document.getElementById("target");

        const category = categoryEl.value;
        const code = codeEl.value;
        const percentage = percentageEl.value;
        const externalUrl = externalUrlEl.value;
        const ctaUrl = ctaUrlEl.value;
        const startDate = startDateEl.value;
        const endDate = endDateEl.value;
        const startTime = startTimeEl.value;
        const endTime = endTimeEl.value;
        const dealerName = dealerNameEl.value;
        const ticketNumber = ticketNumberEl.value;
        const target = targetEl.value;
        const promoType = promoTypeEl.value;

        let hasError = false;
        const validate = (element, condition) => {
          if (!condition) {
            element.classList.add("input-error");
            hasError = true;
          }
        };

        validate(percentageEl, percentage);
        validate(externalUrlEl, externalUrl);
        validate(startDateEl, startDate);
        validate(startTimeEl, startTime);
        validate(endDateEl, endDate);
        validate(endTimeEl, endTime);
        validate(dealerNameEl, dealerName);
        validate(promoTypeEl, promoType);
        validate(ticketNumberEl, ticketNumber);

        if (promoType === "category") {
          validate(categoryEl, category);
          validate(ctaUrlEl, ctaUrl);
        }

        if (hasError) {
          alert("Missing data: Please complete all required fields");
          return;
        }

        // Load master template
        let finalCode = masterHTML;

        // Get selected language texts
        const selectedTexts = translations[langKey];

        let offerText =
          promoType === "sitewide"
            ? selectedTexts.T_OFFER_SITEWIDE
            : selectedTexts.T_OFFER_CATEGORY;

        finalCode = finalCode.replace("[T_OFFER]", offerText);

        // Replace the initial keys from the master template with the selected language texts
        for (let key in selectedTexts) {
          if (key !== "name") {
            // If no code and the key is T_CODE_TEXT, replace with empty string
            if (key === "T_CODE_TEXT" && !code) {
              let regex = new RegExp("\\[" + key + "\\]", "g");
              finalCode = finalCode.replace(regex, "");
              continue;
            }

            let regex = new RegExp("\\[" + key + "\\]", "g");
            finalCode = finalCode.replace(regex, selectedTexts[key]);
          }
        }

        // Replace the selected language keys with the variables
        finalCode = finalCode
          .replace(/\[ENTER_NUMBER\]/g, percentage)
          .replace(/\[ENTER_CATEGORY\]/g, category);

        if (code) {
          finalCode = finalCode.replace(/\[PROMO_CODE\]/g, code);
        }

        if (ctaUrl) {
          finalCode = finalCode.replace(/\[ENTER_CATEGORY_URL\]/g, ctaUrl);
        } else {
          const buttonRegex =
            /<a\s+target="_blank"\s+class="CMC__Espot__Ribbon_CTA-Button[\s\S]*?<\/a>/;
          finalCode = finalCode.replace(buttonRegex, "");
        }

        finalCode = finalCode.replace(/\[ENTER_EXTERNAL_URL\]/g, externalUrl);

        // Generate file name
        const formatDate = (dateStr) => {
          if (!dateStr) return "";
          const [year, month, day] = dateStr.split("-");
          return `${month}${day}${year}`;
        };

        const formattedStartDate = formatDate(startDate);
        const formattedEndDate = formatDate(endDate);

        const linkType =
          !ctaUrl && promoType === "sitewide"
            ? "percentofftclink"
            : "percentofflinkbutton";
        const commonSuffix = `${percentage}${linkType}${
          promoType === "category" ? ctaUrl : ""
        }`;

        const contentFile = `CMC_ESPOT_PCC_CATSAS_RIBBON_TOP | ${formattedStartDate}-${formattedEndDate} | ${commonSuffix} | ${dealerName}`;

        const webActivity = `${formattedStartDate}-${formattedEndDate}_CMC_ESPOT_PCC_CATSAS_RIBBON_TOP_${commonSuffix}`;
        const contentFolder = `${formattedStartDate}-${formattedEndDate}_${commonSuffix}_Content_Folder`;
        const activityFolder = `${formattedStartDate}-${formattedEndDate}_${commonSuffix}_Activity_Folder`;

        const description = `Ticket Number: ${ticketNumber}
Espot Name: CMC_ESPOT_PCC_CATSAS_RIBBON_TOP
Target: ${target}
Start Date (CST): ${startDate} ${startTime}
End Date (CST): ${endDate} ${endTime}`;

        // Show results
        document.getElementById("results").style.display = "block";
        document.getElementById("finalHtml").value = finalCode;
        document.getElementById("contentFile").value = contentFile;
        document.getElementById("webActivity").value = webActivity;
        document.getElementById("contentFolder").value = contentFolder;
        document.getElementById("activityFolder").value = activityFolder;
        document.getElementById("description").value = description;
        document.getElementById("visualPreview").innerHTML = finalCode;
      }

      function copyToClipboard() {
        const copyText = document.getElementById("finalHtml");
        copyText.select();
        document.execCommand("copy");
      }

      // Initialize fields
      toggleFields();
    </script>
  </body>
</html>
