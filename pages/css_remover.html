<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML Cleaner - CSS Remover</title>
    <!-- Prism CSS (Tomorrow Night theme matches dark mode) -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Host+Grotesk:ital,wght@0,300..800;1,300..800&display=swap");
      @import url("../global.css");
    </style>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
    <style>
      p.subtitle {
        color: var(--text-muted);
        font-size: 1.1rem;
        font-weight: bold;
      }

      main {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        flex-grow: 1;
        animation: fadeInUp 0.8s ease-out 0.2s backwards;
      }

      @media (max-width: 768px) {
        main {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        background-color: var(--container-bg);
        border-radius: 1rem;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border: 1px solid var(--border-color);
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease;
        max-height: 80vh; /* Limit height to prevent huge page growth */
        min-width: 0; /* Prevent grid blowout */
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        flex-shrink: 0;
      }

      h2 {
        font-size: 1.25rem;
        font-weight: bold;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .badge {
        font-size: 0.75rem;
        background-color: var(--primary-color);
        color: black;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-weight: 600;
      }

      /* Shared styles for both input textarea and output code block */
      .editor-container {
        overflow: hidden;
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        background-color: var(--border-light);
        transition: border-color 0.2s;
        height: 500px;
      }

      .editor-container:focus-within {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(255, 205, 17, 0.2);
      }

      textarea {
        width: 100%;
        height: 100%;
        background-color: transparent;
        border: none;
        color: var(--text-color);
        padding: 1rem;
        font-family: "Courier New", Courier, monospace;
        font-size: 0.9rem;
        resize: none;
        outline: none;
      }

      /* Prism Overrides & Pre/Code styling */
      pre[class*="language-"] {
        margin: 0 !important;
        height: 100%;
        border-radius: 0 !important;
        background: transparent !important;
        text-shadow: none !important;
        padding: 1rem !important;
        overflow-y: auto !important; /* Allow vertical scrolling */
        overflow-x: hidden !important; /* Hide horizontal scrollbar */
        white-space: pre-wrap !important; /* Force text wrapping */
        word-wrap: break-word !important;
      }

      code[class*="language-"] {
        font-family: "Courier New", Courier, monospace !important;
        font-size: 0.9rem !important;
        white-space: pre-wrap !important; /* Ensure code tag also wraps */
        color: var(--text-color);
      }

      .actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
        justify-content: flex-end;
        flex-shrink: 0;
      }

      button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }

      .btn-primary {
        background-color: var(--primary-color);
        color: black;
      }

      .btn-primary:hover {
        background-color: var(--primary-hover);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background-color: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-muted);
      }

      .btn-secondary:hover {
        background-color: var(--bg-color);
        color: var(--text-muted);
      }

      .btn-copy {
        background-color: var(--secondary-hover);
        color: white;
        opacity: 0.9;
      }

      .btn-copy:hover {
        opacity: 1;
        transform: translateY(-1px);
      }

      /* Animations */
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: var(--bg-color);
      }
      ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--text-muted);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/d/d0/Caterpillar_logo.svg"
          alt="Caterpillar Logo"
          style="height: 40px; vertical-align: middle; margin-right: 10px"
        />
        HTML Cleaner
      </h1>
      <p class="subtitle">
        Removes CSS, Classes, and Styles for a clean translation.
      </p>
    </header>

    <main>
      <!-- Input Section -->
      <section class="panel">
        <div class="panel-header">
          <h2>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
              ></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Original Code
          </h2>
          <button
            id="clearBtn"
            class="btn-secondary"
            style="padding: 0.4rem 0.8rem; font-size: 0.8rem"
          >
            Clear
          </button>
        </div>
        <div class="editor-container">
          <textarea
            id="inputHtml"
            placeholder="Paste your HTML code here..."
          ></textarea>
        </div>
        <div class="actions">
          <button id="processBtn" class="btn-primary">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="4 17 10 11 4 5"></polyline>
              <line x1="12" y1="19" x2="20" y2="19"></line>
            </svg>
            Clean Code
          </button>
        </div>
      </section>

      <!-- Output Section -->
      <section class="panel">
        <div class="panel-header">
          <h2>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            Clean Result
          </h2>
          <span id="statusBadge" class="badge" style="display: none"
            >Processed</span
          >
        </div>
        <div class="editor-container">
          <!-- Prism.js output block -->
          <pre><code id="outputCode" class="language-html"></code></pre>
          <!-- Hidden textarea for copying raw text if needed -->
          <textarea id="hiddenOutput" style="display: none"></textarea>
        </div>
        <div class="actions">
          <button id="copyBtn" class="btn-copy">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path
                d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
              ></path>
            </svg>
            Copy to Clipboard
          </button>
        </div>
      </section>
    </main>

    <!-- External Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.15.4/beautify-html.min.js"></script>

    <script>
      const inputHtml = document.getElementById("inputHtml");
      const outputCode = document.getElementById("outputCode");
      const hiddenOutput = document.getElementById("hiddenOutput");
      const processBtn = document.getElementById("processBtn");
      const copyBtn = document.getElementById("copyBtn");
      const clearBtn = document.getElementById("clearBtn");
      const statusBadge = document.getElementById("statusBadge");

      processBtn.addEventListener("click", () => {
        const rawHtml = inputHtml.value;
        if (!rawHtml.trim()) return;

        // Create a DOM parser
        const parser = new DOMParser();
        const doc = parser.parseFromString(rawHtml, "text/html");

        // 1. Remove <style> tags
        const styleTags = doc.querySelectorAll("style");
        styleTags.forEach((tag) => {
          tag.remove();
        });

        // 1.1 Remove <link rel="stylesheet"> tags (Optional but recommended for "any CSS")
        const linkTags = doc.querySelectorAll('link[rel="stylesheet"]');
        linkTags.forEach((tag) => {
          tag.remove();
        });

        // 2. Remove ALL attributes from all elements
        const allElements = doc.querySelectorAll("*");
        allElements.forEach((el) => {
          while (el.attributes.length > 0) {
            el.removeAttribute(el.attributes[0].name);
          }
        });

        // Serialize back to string
        let cleanHtml = "";
        if (
          rawHtml.toLowerCase().includes("<html") ||
          rawHtml.toLowerCase().includes("<!doctype")
        ) {
          cleanHtml = doc.documentElement.outerHTML;
        } else {
          cleanHtml = doc.body.innerHTML;
        }

        // Format the HTML (Beautify)
        if (window.html_beautify) {
          cleanHtml = window.html_beautify(cleanHtml, {
            indent_size: 2,
            wrap_line_length: 80,
            preserve_newlines: false,
          });
        }

        // Set to hidden textarea for copy
        hiddenOutput.value = cleanHtml;

        // Set to code block (HTML entities encoded automatically by textContent usually,
        // but Prism needs text content to highlight code, so setting textContent is safe)
        outputCode.textContent = cleanHtml;

        // Trigger Prism Highlight
        Prism.highlightElement(outputCode);

        // Update UI
        statusBadge.style.display = "inline-block";
        statusBadge.textContent = "Done!";
      });

      copyBtn.addEventListener("click", () => {
        // Copy from hidden textarea or directly from the clean text
        if (!hiddenOutput.value) return;

        hiddenOutput.style.display = "block"; // logic needs visibility to select sometimes, but let's try navigator API first or simple select
        hiddenOutput.select();
        hiddenOutput.setSelectionRange(0, 99999); // Mobile

        // Modern Copy
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(hiddenOutput.value)
            .then(showCopiedFeedback, fallbackCopy);
        } else {
          fallbackCopy();
        }

        function fallbackCopy() {
          try {
            document.execCommand("copy");
            showCopiedFeedback();
          } catch (e) {
            console.error("Copy failed", e);
          }
          hiddenOutput.style.display = "none";
        }

        function showCopiedFeedback() {
          hiddenOutput.style.display = "none";
          const originalText = copyBtn.innerHTML;
          copyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                Copied
            `;
          setTimeout(() => {
            copyBtn.innerHTML = originalText;
          }, 2000);
        }
      });

      clearBtn.addEventListener("click", () => {
        inputHtml.value = "";
        outputCode.textContent = "";
        hiddenOutput.value = "";
        inputHtml.focus();
      });
    </script>
  </body>
</html>
