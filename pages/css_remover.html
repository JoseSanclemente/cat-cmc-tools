<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>CSS Remover</title>

    <!-- Prism CSS (Tomorrow Night theme matches dark mode) -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />

    <!-- Global font & styles -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Host+Grotesk:ital,wght@0,300..800;1,300..800&display=swap");
      @import url("../styles/global.css");
      @import url("../styles/pages/css_remover.css");
    </style>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
    <!-- End Bootstrap -->

    <!-- Components -->
    <script src="../components/Header.js"></script>
    <!-- End Components -->
  </head>
  <body>
    <header-component title="CSS Remover"></header-component>
    <main class="mt-5">
      <!-- Input Section -->
      <section class="panel">
        <div class="panel-header">
          <h2>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
              ></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Original Code
          </h2>
          <button
            id="clearBtn"
            class="btn-secondary"
            style="padding: 0.4rem 0.8rem; font-size: 0.8rem"
          >
            Clear
          </button>
        </div>
        <div class="editor-container">
          <textarea
            id="inputHtml"
            placeholder="Paste your HTML code here..."
          ></textarea>
        </div>
        <div class="actions">
          <button id="processBtn" class="btn-primary">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="4 17 10 11 4 5"></polyline>
              <line x1="12" y1="19" x2="20" y2="19"></line>
            </svg>
            Clean Code
          </button>
        </div>
      </section>

      <!-- Output Section -->
      <section class="panel">
        <div class="panel-header">
          <h2>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            Clean Result
          </h2>
          <span id="statusBadge" class="badge" style="display: none"
            >Processed</span
          >
        </div>
        <div class="editor-container">
          <!-- Prism.js output block -->
          <pre><code id="outputCode" class="language-html"></code></pre>
          <!-- Hidden textarea for copying raw text if needed -->
          <textarea id="hiddenOutput" style="display: none"></textarea>
        </div>
        <div class="actions">
          <button id="copyBtn" class="btn-copy">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path
                d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
              ></path>
            </svg>
            Copy to Clipboard
          </button>
        </div>
      </section>
    </main>

    <!-- External Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.15.4/beautify-html.min.js"></script>

    <script>
      const inputHtml = document.getElementById("inputHtml");
      const outputCode = document.getElementById("outputCode");
      const hiddenOutput = document.getElementById("hiddenOutput");
      const processBtn = document.getElementById("processBtn");
      const copyBtn = document.getElementById("copyBtn");
      const clearBtn = document.getElementById("clearBtn");
      const statusBadge = document.getElementById("statusBadge");

      processBtn.addEventListener("click", () => {
        const rawHtml = inputHtml.value;
        if (!rawHtml.trim()) return;

        // Create a DOM parser
        const parser = new DOMParser();
        const doc = parser.parseFromString(rawHtml, "text/html");

        // 1. Remove <style> tags
        const styleTags = doc.querySelectorAll("style");
        styleTags.forEach((tag) => {
          tag.remove();
        });

        // 1.1 Remove <link rel="stylesheet"> tags (Optional but recommended for "any CSS")
        const linkTags = doc.querySelectorAll('link[rel="stylesheet"]');
        linkTags.forEach((tag) => {
          tag.remove();
        });

        // 2. Remove ALL attributes from all elements
        const allElements = doc.querySelectorAll("*");
        allElements.forEach((el) => {
          while (el.attributes.length > 0) {
            el.removeAttribute(el.attributes[0].name);
          }
        });

        // Serialize back to string
        let cleanHtml = "";
        if (
          rawHtml.toLowerCase().includes("<html") ||
          rawHtml.toLowerCase().includes("<!doctype")
        ) {
          cleanHtml = doc.documentElement.outerHTML;
        } else {
          cleanHtml = doc.body.innerHTML;
        }

        // Format the HTML (Beautify)
        if (window.html_beautify) {
          cleanHtml = window.html_beautify(cleanHtml, {
            indent_size: 2,
            wrap_line_length: 80,
            preserve_newlines: false,
          });
        }

        // Set to hidden textarea for copy
        hiddenOutput.value = cleanHtml;

        // Set to code block (HTML entities encoded automatically by textContent usually,
        // but Prism needs text content to highlight code, so setting textContent is safe)
        outputCode.textContent = cleanHtml;

        // Trigger Prism Highlight
        Prism.highlightElement(outputCode);

        // Update UI
        statusBadge.style.display = "inline-block";
        statusBadge.textContent = "Done!";
      });

      copyBtn.addEventListener("click", () => {
        // Copy from hidden textarea or directly from the clean text
        if (!hiddenOutput.value) return;

        hiddenOutput.style.display = "block"; // logic needs visibility to select sometimes, but let's try navigator API first or simple select
        hiddenOutput.select();
        hiddenOutput.setSelectionRange(0, 99999); // Mobile

        // Modern Copy
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(hiddenOutput.value)
            .then(showCopiedFeedback, fallbackCopy);
        } else {
          fallbackCopy();
        }

        function fallbackCopy() {
          try {
            document.execCommand("copy");
            showCopiedFeedback();
          } catch (e) {
            console.error("Copy failed", e);
          }
          hiddenOutput.style.display = "none";
        }

        function showCopiedFeedback() {
          hiddenOutput.style.display = "none";
          const originalText = copyBtn.innerHTML;
          copyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                Copied
            `;
          setTimeout(() => {
            copyBtn.innerHTML = originalText;
          }, 2000);
        }
      });

      clearBtn.addEventListener("click", () => {
        inputHtml.value = "";
        outputCode.textContent = "";
        hiddenOutput.value = "";
        inputHtml.focus();
      });
    </script>
  </body>
</html>
